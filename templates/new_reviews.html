{% extends 'Reviewteam.html' %}

{% block title %}New Reviews{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">New Reviews</h2>

    {% if reviews %}
    <div class="table-responsive">
        <table class="table table-hover table-bordered text-center">
            <thead class="table-dark">
                <tr>
                    <th>Username</th>
                    <th>ETH Address</th>
                    <th>View Details</th>
                </tr>
            </thead>
            <tbody>
                {% for review in reviews %}
                <tr>
                    <td>{{ review.farmer_details.username }}</td>
                    <td>{{ review.eth_address }}</td>
                    <td>
                        <!-- Click Here Button -->
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal{{ loop.index }}">
                            <i class="fas fa-eye"></i> Click Here
                        </button>
                    </td>
                </tr>

                <!-- Modal for Details -->
                <div id="modal{{ loop.index }}" class="modal fade" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" style="max-width: 50%;">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Application Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p><strong>Application ID:</strong> {{ review.application_id }}</p>
                                <p><strong>Blockchain ID:</strong> {{ review.blockchain_id }}</p>
                                <p><strong>Crop Name:</strong> {{ review.crop_details.cropName }}</p>
                                <p><strong>Crop Type:</strong> {{ review.crop_details.cropType }}</p>
                                <p><strong>Sow Date:</strong> {{ review.crop_details.sowDate }}</p>
                                <p><strong>Harvest Date:</strong> {{ review.crop_details.harvestDate }}</p>
                                <p><strong>District:</strong> {{ review.crop_details.district }}</p>
                                <p><strong>Address:</strong> {{ review.farmer_details.userAddress }}</p>
                                <p><strong>Farmer Name:</strong> {{ review.farmer_details.username }}</p>
                                <p><strong>Status:</strong> <span class="badge bg-warning text-dark">{{ review.status }}</span></p>

                                <!-- Accept Application Button -->
                                <form id="acceptForm" action="/review_accept" method="POST">
                                    <input type="hidden" name="eth_address" value="{{ review.eth_address }}">
                                    <button type="submit"  class="  btn btn-success">Accept</button>
                                </form>


                                
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-danger" data-bs-dismiss="modal">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle"></i> No new reviews found.
    </div>
    {% endif %}
</div>

<!-- Bootstrap & FontAwesome -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    function confirmDecline() {
        return confirm("Are you sure you want to decline this application?");
    }
    </script>
{% endblock %}
